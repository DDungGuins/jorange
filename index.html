<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>조랑이의 바람일기 박물관</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #000; color: #fff; margin: 0; overflow-x: hidden; }
        
        /* 뷰어 핵심 스타일 */
        #viewer-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100vw;
            height: calc(100vh - 110px); /* 헤더 제외 높이 */
            overflow: hidden; /* 맞춤 모드일 때 스크롤 방지 */
        }

        /* 기본 크기 모드일 때만 스크롤 허용 */
        #viewer-container.mode-original {
            height: auto;
            min-height: 100vh;
            overflow-y: auto;
            display: block;
        }

        .comic-img {
            display: block;
            margin: 0 auto;
            object-fit: contain;
            transition: all 0.2s ease-in-out;
        }

        /* 가로 맞춤: 너비 100%, 높이는 화면 안으로 제한 */
        .mode-width .comic-img {
            width: 100vw;
            height: 100%;
            max-height: 100%;
        }

        /* 세로 맞춤: 높이 100%, 너비는 비율 유지 */
        .mode-height .comic-img {
            height: 100%;
            width: auto;
            max-width: 100vw;
        }

        /* 기본 크기: 이미지 원래 너비 사용 */
        .mode-original .comic-img {
            width: auto;
            max-width: 100vw;
            height: auto;
        }

        /* 전체화면 시 스타일 */
        :fullscreen #viewer-container {
            height: 100vh;
            width: 100vw;
        }
        :fullscreen header { display: none; }

        /* 터치 힌트 */
        #swipe-hint {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.7);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            opacity: 0;
            transition: opacity 0.5s;
            pointer-events: none;
        }
    </style>
</head>
<body>

    <header class="bg-[#1a1a1a] border-b border-gray-800 sticky top-0 z-30 p-2">
        <div class="max-w-4xl mx-auto space-y-2">
            <div class="flex gap-2">
                <select id="cat-select" class="flex-1 bg-[#2a2a2a] text-sm p-2 rounded border border-gray-700 outline-none">
                    <option value="jorang">조랑이의 바람일기 (본편)</option>
                    <option value="extra">조랑이의 바람일기 (외전)</option>
                    <option value="kim">김군의 일기</option>
                    <option value="yeon">바람의나라 연 일기</option>
                </select>
                <button onclick="toggleFullScreen()" class="bg-blue-600 px-3 py-1 rounded text-xs font-bold">전체화면</button>
            </div>
            
            <div class="flex justify-between items-center bg-[#252525] p-1 rounded-lg">
                <div class="flex gap-1">
                    <button onclick="setMode('width')" id="btn-width" class="bg-gray-700 hover:bg-blue-500 px-2 py-1 rounded text-[10px]">가로 맞춤</button>
                    <button onclick="setMode('height')" id="btn-height" class="bg-gray-700 hover:bg-green-500 px-2 py-1 rounded text-[10px]">세로 맞춤</button>
                    <button onclick="setMode('original')" id="btn-original" class="bg-gray-700 hover:bg-yellow-600 px-2 py-1 rounded text-[10px]">기본 크기</button>
                </div>
                <div class="flex items-center gap-4 pr-2">
                    <button onclick="changeEp(-1)" class="text-xl">◀</button>
                    <span id="ep-info" class="font-bold text-yellow-500 min-w-[40px] text-center">1화</span>
                    <button onclick="changeEp(1)" class="text-xl">▶</button>
                </div>
            </div>
        </div>
    </header>

    <main id="viewer-container" class="mode-width">
        <div id="viewer-content" class="w-full h-full flex flex-col items-center justify-start">
            </div>
    </main>

    <div id="swipe-hint">좌우로 밀어서 다음 화/이전 화</div>

    <script>
        let currentCat = 'jorang';
        let currentEp = 1;
        let db = {};
        
        // 터치 제스처용
        let startX = 0;

        async function init() {
            try {
                const [jorang, extra, kim, yeon] = await Promise.all([
                    fetch('./file_list.json').then(res => res.json()),
                    fetch('./file_list_외전.json').then(res => res.json()),
                    fetch('./file_list_kim.json').then(res => res.json()),
                    fetch('./file_list_바람_연.json').then(res => res.json())
                ]);
                db = { jorang, extra, kim, yeon };
                render();
                showHint();
            } catch (e) { alert('데이터를 불러오지 못했습니다.'); }
        }

        function render() {
            const content = document.getElementById('viewer-content');
            content.innerHTML = '';
            const data = db[currentCat];

            if (currentCat === 'kim') {
                const pages = data[currentEp] || [];
                pages.forEach(name => {
                    const img = document.createElement('img');
                    img.src = `./김군의 일기/${name}`;
                    img.className = "comic-img";
                    content.appendChild(img);
                });
            } else if (currentCat === 'jorang') {
                const img = document.createElement('img');
                img.src = `./${data[currentEp - 1]}`;
                img.className = "comic-img";
                content.appendChild(img);
            } else {
                const folder = currentCat === 'extra' ? '조랑이의 바람일기 외전' : '바람의나라 연 일기';
                const img = document.createElement('img');
                img.src = `./${folder}/${data[currentEp - 1]}`;
                img.className = "comic-img";
                content.appendChild(img);
            }

            document.getElementById('ep-info').innerText = `${currentEp}화`;
            window.scrollTo(0, 0);
        }

        // 1. 크기 모드 설정 (가로/세로/기본)
        function setMode(mode) {
            const container = document.getElementById('viewer-container');
            container.classList.remove('mode-width', 'mode-height', 'mode-original');
            container.classList.add(`mode-${mode}`);
            
            // 버튼 강조
            document.querySelectorAll('[id^="btn-"]').forEach(btn => btn.classList.replace('bg-blue-500', 'bg-gray-700'));
            document.getElementById(`btn-${mode}`).classList.replace('bg-gray-700', 'bg-blue-500');
        }

        // 2. 전체화면 제어
        function toggleFullScreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen().catch(err => {
                    alert(`전체화면 오류: ${err.message}`);
                });
            } else {
                document.exitFullscreen();
            }
        }

        // 3. 모바일 스와이프
        document.addEventListener('touchstart', e => startX = e.touches[0].clientX);
        document.addEventListener('touchend', e => {
            const endX = e.changedTouches[0].clientX;
            const diff = startX - endX;
            if (Math.abs(diff) > 80) {
                if (diff > 0) changeEp(1);
                else changeEp(-1);
            }
        });

        function changeEp(delta) {
            const max = currentCat === 'kim' ? Object.keys(db.kim).length : db[currentCat].length;
            const next = currentEp + delta;
            if (next >= 1 && next <= max) {
                currentEp = next;
                render();
            }
        }

        function showHint() {
            const hint = document.getElementById('swipe-hint');
            hint.style.opacity = '1';
            setTimeout(() => hint.style.opacity = '0', 3000);
        }

        document.getElementById('cat-select').onchange = (e) => {
            currentCat = e.target.value;
            currentEp = 1;
            render();
        };

        init();
        setMode('width'); // 기본값 가로 맞춤
    </script>
</body>
</html>
