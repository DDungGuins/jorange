<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>조랑이의 바람일기 박물관</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root { --viewer-width: 100%; }
        body { background-color: #1a1a1a; color: #fff; } /* 가시성 좋은 다크모드 */
        .comic-img { width: var(--viewer-width); height: auto; display: block; margin: 0 auto; transition: width 0.3s; }
        .fit-height { height: 90vh !important; width: auto !important; }
        /* 터치 영역 시각화 */
        #touch-area { position: fixed; inset: 0; z-index: 5; pointer-events: none; }
    </style>
</head>
<body class="overflow-x-hidden">

    <header class="bg-[#2d2d2d] shadow-lg sticky top-0 z-30 p-3">
        <div class="max-w-3xl mx-auto space-y-3">
            <div class="flex gap-2">
                <select id="cat-select" class="flex-1 bg-[#3d3d3d] text-white p-2 border border-gray-600 rounded-lg font-bold outline-none">
                    <option value="jorang">조랑이의 바람일기 (본편)</option>
                    <option value="extra">조랑이의 바람일기 (외전)</option>
                    <option value="kim">김군의 일기</option>
                    <option value="yeon">바람의나라 연 일기</option>
                </select>
                <button onclick="toggleFullScreen()" class="bg-gray-700 px-3 py-2 rounded-lg text-sm hover:bg-gray-600">전체화면</button>
            </div>
            
            <div class="flex justify-between items-center gap-2">
                <div class="flex gap-1">
                    <button onclick="setSize('width')" class="bg-blue-600 px-3 py-1 rounded text-xs">가로 맞춤</button>
                    <button onclick="setSize('height')" class="bg-green-600 px-3 py-1 rounded text-xs">세로 맞춤</button>
                </div>
                <div class="flex items-center gap-3">
                    <button onclick="changeEp(-1)" class="text-2xl px-2">◀</button>
                    <span id="ep-info" class="font-bold text-lg text-yellow-400">1화</span>
                    <button onclick="changeEp(1)" class="text-2xl px-2">▶</button>
                </div>
            </div>
        </div>
    </header>

    <main id="viewer" class="relative max-w-5xl mx-auto flex flex-col items-center min-h-screen pt-2">
        </main>

    <div id="swipe-hint" class="fixed bottom-10 left-1/2 -translate-x-1/2 bg-black/60 px-4 py-2 rounded-full text-sm pointer-events-none opacity-0 transition-opacity">
        좌우로 밀어서 화 이동
    </div>

    <script>
        let currentCat = 'jorang';
        let currentEp = 1;
        let db = {};
        let isFitHeight = false;

        // 터치 좌표 저장용
        let touchStartX = 0;
        let touchEndX = 0;

        async function init() {
            try {
                const [jorang, extra, kim, yeon] = await Promise.all([
                    fetch('./file_list.json').then(res => res.json()),
                    fetch('./file_list_외전.json').then(res => res.json()),
                    fetch('./file_list_kim.json').then(res => res.json()),
                    fetch('./file_list_바람_연.json').then(res => res.json())
                ]);
                db = { jorang, extra, kim, yeon };
                render();
                showHint();
            } catch (e) { console.error(e); }
        }

        function render() {
            const viewer = document.getElementById('viewer');
            viewer.innerHTML = '';
            const data = db[currentCat];

            if (currentCat === 'kim') {
                const pages = data[currentEp] || [];
                pages.forEach(name => {
                    const img = document.createElement('img');
                    img.src = `./김군의 일기/${name}`;
                    img.className = `comic-img ${isFitHeight ? 'fit-height' : ''}`;
                    viewer.appendChild(img);
                });
            } else if (currentCat === 'jorang') {
                const img = document.createElement('img');
                img.src = `./${data[currentEp - 1]}`;
                img.className = `comic-img ${isFitHeight ? 'fit-height' : ''}`;
                viewer.appendChild(img);
            } else {
                const folder = currentCat === 'extra' ? '조랑이의 바람일기 외전' : '바람의나라 연 일기';
                const img = document.createElement('img');
                img.src = `./${folder}/${data[currentEp - 1]}`;
                img.className = `comic-img ${isFitHeight ? 'fit-height' : ''}`;
                viewer.appendChild(img);
            }

            document.getElementById('ep-info').innerText = `${currentEp}화`;
            window.scrollTo(0, 0);
        }

        // 기능 1: 이미지 크기 조절
        function setSize(type) {
            isFitHeight = (type === 'height');
            render();
        }

        // 기능 2: 전체화면 모드
        function toggleFullScreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                if (document.exitFullscreen) document.exitFullscreen();
            }
        }

        // 기능 3: 모바일 스와이프 감지
        document.addEventListener('touchstart', e => {
            touchStartX = e.changedTouches[0].screenX;
        });

        document.addEventListener('touchend', e => {
            touchEndX = e.changedTouches[0].screenX;
            handleSwipe();
        });

        function handleSwipe() {
            const swipeDistance = touchEndX - touchStartX;
            if (Math.abs(swipeDistance) > 100) { // 100px 이상 밀었을 때만 작동
                if (swipeDistance > 0) changeEp(-1); // 오른쪽으로 밀면 이전화
                else changeEp(1); // 왼쪽으로 밀면 다음화
            }
        }

        function changeEp(delta) {
            const max = currentCat === 'kim' ? Object.keys(db.kim).length : db[currentCat].length;
            const next = currentEp + delta;
            if (next >= 1 && next <= max) {
                currentEp = next;
                render();
            }
        }

        function showHint() {
            const hint = document.getElementById('swipe-hint');
            hint.style.opacity = '1';
            setTimeout(() => hint.style.opacity = '0', 3000);
        }

        document.getElementById('cat-select').onchange = (e) => {
            currentCat = e.target.value;
            currentEp = 1;
            render();
        };

        init();
    </script>
</body>
</html>
