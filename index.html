<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>조랑이의 바람일기 박물관</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #000; color: #fff; margin: 0; overflow: hidden; font-family: sans-serif; }
        
        header { height: 110px; background: #1a1a1a; z-index: 40; position: relative; border-bottom: 1px solid #333; }

        /* 메인 뷰어 */
        #viewer-container {
            width: 100vw;
            height: calc(100vh - 110px);
            overflow: hidden;
            position: relative;
        }

        :fullscreen #viewer-container { height: 100vh; }
        :fullscreen header { display: none; }

        .comic-img { display: block; flex-shrink: 0; object-fit: contain; }

        /* [1] 가로 맞춤 (웹툰 방식) */
        .mode-width { overflow-y: auto !important; display: block !important; scroll-behavior: smooth; }
        .mode-width .comic-img { width: 100vw; height: auto; }

        /* [2] 세로 맞춤 (한 장씩 넘기기) */
        .mode-height { 
            display: flex !important; 
            flex-direction: row; 
            overflow-x: auto !important; 
            overflow-y: hidden !important; 
            scroll-snap-type: x mandatory; /* 스냅 활성화 */
            scroll-behavior: smooth;
        }
        .mode-height .comic-img {
            height: 100%;
            width: 100vw; /* 한 화면에 한 장만 꽉 차게 */
            scroll-snap-align: center;
            scroll-snap-stop: always; /* 중요: 세게 밀어도 한 장씩만 멈춤 */
        }

        /* [3] 기본 크기 */
        .mode-original { overflow: auto !important; display: block !important; }
        .mode-original .comic-img { width: auto; max-width: 100vw; height: auto; margin: 0 auto; }

        /* 전체화면용 플로팅 버튼 */
        #fs-nav {
            position: fixed;
            bottom: 20px;
            left: 0;
            right: 0;
            display: none; /* 평소엔 숨김 */
            justify-content: center;
            gap: 20px;
            z-index: 100;
            pointer-events: none;
        }
        :fullscreen #fs-nav { display: flex; }
        .fs-btn {
            pointer-events: auto;
            background: rgba(0,0,0,0.6);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            padding: 10px 20px;
            border-radius: 30px;
            backdrop-filter: blur(5px);
            font-weight: bold;
        }

        /* 커스텀 스크롤바 (모바일용) */
        #viewer-container::-webkit-scrollbar { display: none; }
    </style>
</head>
<body>

    <header class="flex flex-col justify-center px-4">
        <div class="flex gap-2 mb-2">
            <select id="cat-select" class="flex-1 bg-[#2a2a2a] text-sm p-2 rounded border border-gray-700 outline-none">
                <option value="jorang">조랑이의 바람일기 (본편)</option>
                <option value="extra">조랑이의 바람일기 (외전)</option>
                <option value="kim">김군의 일기</option>
                <option value="yeon">바람의나라 연 일기</option>
            </select>
            <button onclick="toggleFullScreen()" class="bg-blue-700 px-4 py-1 rounded text-xs font-bold">전체화면</button>
        </div>
        
        <div class="flex justify-between items-center">
            <div class="flex gap-1" id="mode-buttons">
                <button onclick="setMode('width')" id="btn-width" class="bg-blue-600 px-2 py-1 rounded text-[10px] text-white">가로 맞춤</button>
                <button onclick="setMode('height')" id="btn-height" class="bg-gray-700 px-2 py-1 rounded text-[10px] text-white">세로 맞춤</button>
                <button onclick="setMode('original')" id="btn-original" class="bg-gray-700 px-2 py-1 rounded text-[10px] text-white">기본 크기</button>
            </div>
            <div class="flex items-center gap-4">
                <button onclick="changeEp(-1)" class="text-2xl px-2">◀</button>
                <span id="ep-info" class="font-bold text-yellow-500 min-w-[50px] text-center text-lg">1화</span>
                <button onclick="changeEp(1)" class="text-2xl px-2">▶</button>
            </div>
        </div>
    </header>

    <div id="fs-nav">
        <button class="fs-btn" onclick="changeEp(-1)">이전 화</button>
        <button class="fs-btn" onclick="toggleFullScreen()">종료</button>
        <button class="fs-btn" onclick="changeEp(1)">다음 화</button>
    </div>

    <main id="viewer-container" class="mode-width">
        <div id="viewer-inner" style="display: contents;"></div>
    </main>

    <script>
        let currentCat = 'jorang';
        let currentEp = 1;
        let db = {};
        let currentMode = 'width';

        async function init() {
            try {
                const [jorang, extra, kim, yeon] = await Promise.all([
                    fetch('./file_list.json').then(res => res.json()),
                    fetch('./file_list_외전.json').then(res => res.json()),
                    fetch('./file_list_kim.json').then(res => res.json()),
                    fetch('./file_list_바람_연.json').then(res => res.json())
                ]);
                db = { jorang, extra, kim, yeon };
                render();
            } catch (e) { alert('데이터 로딩 실패! JSON 파일명을 확인하세요.'); }
        }

        function render() {
            const inner = document.getElementById('viewer-inner');
            const container = document.getElementById('viewer-container');
            inner.innerHTML = '';
            const data = db[currentCat];

            let imagePaths = [];
            if (currentCat === 'kim') {
                const pages = data[currentEp] || [];
                imagePaths = pages.map(name => `./김군의 일기/${name}`);
            } else if (currentCat === 'jorang') {
                imagePaths = [`./${data[currentEp - 1]}`];
            } else {
                const folder = currentCat === 'extra' ? '조랑이의 바람일기 외전' : '바람의나라 연 일기';
                imagePaths = [`./${folder}/${data[currentEp - 1]}`];
            }

            imagePaths.forEach(path => {
                const img = document.createElement('img');
                img.src = path;
                img.className = "comic-img";
                inner.appendChild(img);
            });

            document.getElementById('ep-info').innerText = `${currentEp}화`;
            container.scrollTo(0, 0); // 화 변경 시 스크롤 맨 위/앞으로 초기화
        }

        function setMode(mode) {
            currentMode = mode;
            const container = document.getElementById('viewer-container');
            container.className = `mode-${mode}`;
            
            document.querySelectorAll('#mode-buttons button').forEach(btn => {
                btn.className = "bg-gray-700 px-2 py-1 rounded text-[10px] text-white";
            });
            document.getElementById(`btn-${mode}`).className = "bg-blue-600 px-2 py-1 rounded text-[10px] text-white";
            
            render();
        }

        function changeEp(delta) {
            const max = currentCat === 'kim' ? Object.keys(db.kim).length : db[currentCat].length;
            const next = currentEp + delta;
            if (next >= 1 && next <= max) {
                currentEp = next;
                render();
            }
        }

        function toggleFullScreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                if (document.exitFullscreen) document.exitFullscreen();
            }
        }

        document.getElementById('cat-select').onchange = (e) => {
            currentCat = e.target.value;
            currentEp = 1;
            render();
        };

        init();
    </script>
</body>
</html>
